# AntibodyPipeline 单机版架构与交互逻辑

## 技术选型
- **前端**：React（通过本地静态资源加载，单机无需构建链路）。  
- **后端**：Python 标准库 `http.server` 提供 API 与静态资源服务。  
- **数据库**：SQLite（单机部署，适配数据量与流程追踪）。  
- **数据模型层**：推荐使用 SQLModel 或 SQLAlchemy（后续扩展）。  

## 业务对象与数据结构（建议）
### 1. 批次（Batch）
| 字段 | 说明 |
| --- | --- |
| id | 批次编号，例如 `B-2025-01` |
| name | 批次名称 |
| owner | 项目/负责人 |
| sample_count | 样本数量（96-384） |
| status | 状态：todo/running/done/blocked |
| created_at | 创建时间 |

### 2. 样本（Sample）
| 字段 | 说明 |
| --- | --- |
| id | 样本唯一 ID |
| batch_id | 所属批次 |
| name | 样本名称 |
| original_name | 原始名称（保留历史） |
| metadata | 解析得到的序列或标签 |

### 3. 96 孔板（Plate）
| 字段 | 说明 |
| --- | --- |
| id | 96 孔板 ID |
| batch_id | 所属批次 |
| step_key | 所在流程环节 |
| version | 版本号（修改保留历史） |

### 4. 孔位记录（PlateWell）
| 字段 | 说明 |
| --- | --- |
| id | 唯一 ID |
| plate_id | 关联板 |
| well | 孔位，如 A01 |
| sample_id | 样本 ID |
| value | 环节对应的信息（浓度/克隆名等） |
| history | JSON 记录历史变更 |

### 5. 流程步骤（Step）
| 字段 | 说明 |
| --- | --- |
| key | SOP 环节标识 |
| label | 展示名称 |
| order | 顺序 |

### 6. 批次-步骤状态（BatchStep）
| 字段 | 说明 |
| --- | --- |
| batch_id | 批次 ID |
| step_key | 步骤 ID |
| status | todo/running/done/blocked |
| started_at | 开始时间 |
| finished_at | 完成时间 |

## 核心交互逻辑设计
1. **批次创建**  
   - 上传批次文件（96-384 样本）后生成批次与样本记录。  
   - 系统自动生成初始 96 孔板布局。  

2. **流程驱动（SOP 顺序）**  
   - 前端按 SOP 展示步骤与状态，可在甘特图/时间线中查看。  
   - 每次执行脚本入口都会关联到具体步骤并更新 BatchStep 状态。  

3. **96 孔板编辑**  
   - 每一步可在前端编辑孔位信息。  
   - 每次修改生成新版本，旧版本保留在 `history` 中。  

4. **总览与追踪**  
   - 批次总览页面支持多批次筛选。  
   - 支持查看样本在各环节的状态与历史修改记录。  

5. **复做批次**  
   - 支持从多个批次中选择样本，创建新批次。  
   - 系统保留原批次引用关系，用于后续统计与追溯。  

## 未来扩展
- 设计脚本执行日志表（ActionLog），保留运行参数与产出路径。  
- 支持导出批次进度为甘特图或 CSV 报表。  
- 增加基于角色的权限控制（管理员/实验员/审核）。  
